<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra Confirmada - R$39,90</title>
    
    <!-- Camada de Dados para GTM -->
    <script>
        window.dataLayer = window.dataLayer || [];
        dataLayer.push({
            event: "purchase_main",  // Nome do evento alterado
            Value: 39.90,            // Valor atualizado
            Currency: "BRL",
            content_ids: ['main_offer'],  // IDs atualizados
            content_type: 'product',
            fbclid: new URLSearchParams(location.search).get('fbclid') || '',
            offer_type: 'main'  // Novo parâmetro para diferenciação
        });
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){
        w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
        j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K3SZTP8L');</script>
    <!-- End Google Tag Manager -->

    <!-- Facebook Pixel Configuração Atualizada -->
    <script>
        // 1. INICIALIZAÇÃO DO PIXEL
        if(!window._pixelInitDone) {
            window._pixelInitDone = true;
            
            !function(f,b,e,v,n,t,s){
                if(f.fbq)return;
                n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};
                if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
                n.queue=[];t=b.createElement(e);t.async=!0;
                t.src=v;s=b.getElementsByTagName(e)[0];
                s.parentNode.insertBefore(t,s)
            }(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
            
            fbq('init', '1345211853386206');
            fbq('track', 'PageView');
        }

        // 2. FUNÇÃO DE COMPRA ATUALIZADA
        function trackPurchase() {
            const isDebug = new URLSearchParams(location.search).has('debug');
            const fbclid = new URLSearchParams(location.search).get('fbclid') || '';
            
            // Dados atualizados para oferta principal
            const eventData = {
                value: 39.90,              // Valor principal
                currency: 'BRL',
                content_ids: ['main_offer'],  // IDs da oferta principal
                content_type: 'product',
                fbclid: fbclid,
                fbc: document.cookie.match(/_fbc=([^;]+)/)?.[1] || '',
                fbp: document.cookie.match(/_fbp=([^;]+)/)?.[1] || '',
                offer_type: 'main'  // Parâmetro adicional
            };

            // Disparo dos eventos
            fbq('track', 'Purchase', eventData);
            
            // Atualização do dataLayer
            window.dataLayer = window.dataLayer || [];
            dataLayer.push({
                'event': 'purchase_main',  // Evento diferente
                ...eventData
            });

            // Debug aprimorado
            if(isDebug) {
                console.log('✅ Rastreamento da oferta principal concluído', {
                    'FBClID': fbclid || 'Não encontrado',
                    'Valor': eventData.value,
                    'Tipo de Oferta': eventData.offer_type,
                    'Dados Enviados': eventData
                });
            }
        }

        // Disparo seguro
        if(document.readyState === 'complete') {
            trackPurchase();
        } else {
            window.addEventListener('DOMContentLoaded', trackPurchase);
        }
    </script>
    <noscript>
        <img height="1" width="1" style="display:none" 
             src="https://www.facebook.com/tr?id=1345211853386206&ev=Purchase&noscript=1"/>
    </noscript>
</head>
<body style="font-family: Arial; text-align: center; padding: 50px; background: #f5f5f5;">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K3SZTP8L"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <h1>✅ Compra confirmada!</h1>
    <p>Obrigado por adquirir nossa oferta principal por <strong>R$39,90</strong>.</p>
    <p>Aguarde, você será redirecionado...</p>
    
    <script>
        // REDIRECIONAMENTO
        if(!new URLSearchParams(location.search).has('debug')) {
            setTimeout(() => {
                window.location.href = "https://compra-confirmada.my.canva.site";
            }, 5000);
        }
    </script>
</body>
</html>
